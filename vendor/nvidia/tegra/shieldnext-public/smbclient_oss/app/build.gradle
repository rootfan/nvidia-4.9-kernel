apply plugin: 'com.android.application'

android {
    compileSdkVersion 26
    buildToolsVersion = rootProject.buildToolsVersion

    defaultConfig.with {
        applicationId = "com.nvidia.shield.smbauth"
        minSdkVersion = 24
        targetSdkVersion = 26
        versionCode = genVersionCode()
        versionName = "${genVersionCode()}"

        signingConfigs {
            create("debugKey") {
                storeFile file('../keystore/debug.keystore')
                storePassword "android"
                keyAlias "androiddebugkey"
                keyPassword "android"
                storeType "jks"
            }
        }
        signingConfigs {
            create("aosp") {
                storeFile file('../keystore/platform.keystore')
                storePassword "android"
                keyAlias "platform"
                keyPassword "android"
                storeType "jks"
            }
        }

        ndk {
            abiFilters "armeabi-v7a", "arm64-v8a"
        }

        externalNativeBuild {
            cmake {
                cFlags "-frtti", "-fexceptions"
            }
        }
    }

    buildTypes {
        release {
            minifyEnabled true
            proguardFiles.add(file("proguard-rules.pro"))
            signingConfig signingConfigs.aosp
        }
        debug{
            signingConfig signingConfigs.debugKey
            versionNameSuffix ="-debug"
        }

        flavorDimensions "default"
    }

    android.productFlavors {
        create("arm64") {
            ndk {
                abiFilters "arm64-v8a"
            }
            versionName = "${genVersionCode()}" + "-arm64"
        }

        create("full") {

        }
    }

    externalNativeBuild {

        // Encapsulates your CMake build configurations.
        cmake {

            // Provides a relative path to your CMake build script.
            path "CMakeLists.txt"
        }
    }

    sourceSets {
        main {
            jniLibs.srcDirs 'src/main/jni/libs'
        }
    }
}

android {
    lintOptions {
        checkReleaseBuilds false
        abortOnError false
    }
    compileOptions {
        targetCompatibility 1.8
        sourceCompatibility 1.8
    }
}

def genVersionCode() {
    def date = new Date()
    def formattedDate = date.format('yyyyMMdd')
    def code = formattedDate.toInteger()
    return code
}

repositories {
    maven { url '../dependencies' }
}

dependencies {
    compile fileTree(dir: 'libs', include: ['*.jar'])
    compile 'com.android.support:leanback-v17:' + supportLibVersion
    compile 'android.arch.persistence.room:runtime:' + archRoomVersion;

    compile project(':leanbacksettings')
}
